<div class="bg-surface dark:bg-surface-dark h-screen grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 grid-rows-8 md:grid-rows-7 xl:grid-rows-5 auto-rows-fr gap-6 p-8">
    <div class="md:col-span-2 row-span-4">
        <app-card>

            @if (stock) {
                <div class="grid grid-cols-1 grid-rows-8 w-full h-full">
                    <div class="row-span-1 col-span-1 flex justify-between mb-2">
                        <div>
                            <h2 class="text-2xl">{{ stock && stock.stockInfo.companyName }}</h2>
                            <p class="text-on-surface/50 dark:text-on-surface-dark/50">{{ stock && stock.stockInfo.symbol }}</p>
                        </div>

                        <div class="text-right">
                            <h2 class="text-2xl">${{ currentPrice }}</h2>
                        </div>
                    </div>



                    <div class="row-span-7 col-span-1 mt-2 flex flex-col items-center justify-center w-full h-full">
                        <hr class="border-gray-300 dark:border-neutral-700 border-1 w-full mx-auto mb-5">


                        @if (chartOptions) {
                            <ag-charts class="w-full h-full"
                                [options]="chartOptions">
                            </ag-charts>
                        }
                    </div>
                </div>


            } @else {
                <p>Loading</p>
            }

        </app-card>
    </div>

    <div class="row-span-4 md:col-span-2 xl:col-span-1">
        <app-card>
            @if ( wallet ) {
                <h2 class="text-2xl text-on-surface-strong dark:text-on-surface-dark-strong">Buy {{ stock && stock.stockInfo.symbol }}</h2>

                <form [formGroup]="buyForm" (ngSubmit)="onSubmit()" class="mt-6">
        
                    <div class="mb-4">
                    <label class="flex w-fit items-center gap-1 pl-0.5 text-sm"
                        [ngClass]="quantityInvalid ? 'text-danger' : 'text-on-surface dark:text-on-surface-dark'">
                        <ng-container *ngIf="quantityInvalid">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" aria-hidden="true" fill="currentColor" class="w-4 h-4">
                            <path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"/>
                        </svg>
                        </ng-container>
                        Quantity
                    </label>
                    <input ngModel pattern="[0-9]*" [ngClass]="{'border-danger': quantityInvalid}" type="number" formControlName="quantity" 
                        class="w-full p-2 mt-1 border rounded outline-none bg-surface dark:bg-surface-dark text-on-surface dark:text-on-surface-dark focus:ring-2 focus:ring-outline dark:focus:ring-outline-dark">
                        @if (quantityInvalid) {
                            @if (quantityNonInt) {
                                <small class="pl-0.5 text-danger">Error: Quantity must be an integer</small>
                            } @else {
                                <small class="pl-0.5 text-danger">Error: Quantity is required</small>

                            }
                        } @else {
                            
                        }
                    </div>

                    <div class="my-3">
                        @if (quantity && !quantityInvalid) {
                            <div class="flex justify-between my-1">
                                <p class="text-md">Current balance:</p>
                                <p class="text-md text-right font-medium">${{ wallet.wallet.balance | number:'1.2-2' }}</p>
                            </div>
                            <div class="flex justify-between my-1">
                                <p class="text-md">Cost for {{ quantity | number:'1.0' }} shares:</p>
                                <p class="text-md text-right font-medium">${{ (currentPrice * quantity) | number:'1.2-2' }}</p>
                            </div>
                            <div class="flex justify-between my-1">
                                <p class="text-md">New balance:</p>
                                <p class="text-md text-right">${{ (+wallet.wallet.balance - currentPrice * quantity) | number:'1.2-2' }}</p>
                            </div>
                        }
                        
                    </div>
                    
                    

                    <button type="submit" class="cursor-pointer w-full py-2 text-on-primary dark:text-on-primary-dark rounded bg-primary dark:bg-primary-dark hover:bg-secondary dark:hover:bg-secondary-dark">
                        Purchase
                    </button>
                </form>

            }
        </app-card>
    </div>
</div>

